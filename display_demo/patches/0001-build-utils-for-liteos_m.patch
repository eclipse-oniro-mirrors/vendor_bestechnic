From a336e168e9696c21d63461d8259c4aaa6befc4e8 Mon Sep 17 00:00:00 2001
From: leihuang <leihuang@bestechnic.com>
Date: Sun, 19 Sep 2021 14:35:36 +0800
Subject: [PATCH] build utils for liteos_m

Signed-off-by: leihuang <leihuang@bestechnic.com>
Change-Id: I308727514c5eadce3ead6d0c9e9ce2c6034f1c97
---
 js/builtin/BUILD.gn            | 2 +-
 js/builtin/common/BUILD.gn     | 9 ++++++++-
 js/builtin/filekit/BUILD.gn    | 8 +++++++-
 js/builtin/kvstorekit/BUILD.gn | 8 +++++++-
 kal/timer/BUILD.gn             | 9 ++++++++-
 timer_task/BUILD.gn            | 9 ++++++++-
 6 files changed, 39 insertions(+), 6 deletions(-)

diff --git a/js/builtin/BUILD.gn b/js/builtin/BUILD.gn
index 7c5a7d7..1ed4c0c 100755
--- a/js/builtin/BUILD.gn
+++ b/js/builtin/BUILD.gn
@@ -18,7 +18,7 @@ import("//build/lite/config/component/lite_component.gni")
 lite_component("ace_utils_kits") {
   features = [
     "common:ace_kit_common",
-    "deviceinfokit:ace_kit_deviceinfo",
+    # "deviceinfokit:ace_kit_deviceinfo",
     "filekit:ace_kit_file",
     "kvstorekit:ace_kit_kvstore",
     "//utils/native/lite/timer_task:ace_kit_timer",
diff --git a/js/builtin/common/BUILD.gn b/js/builtin/common/BUILD.gn
index dd8f39a..699965e 100755
--- a/js/builtin/common/BUILD.gn
+++ b/js/builtin/common/BUILD.gn
@@ -13,7 +13,14 @@
 # limitations under the License.
 #
 
-shared_library("ace_kit_common") {
+import("//build/lite/config/component/lite_component.gni")
+
+lite_library("ace_kit_common") {
+  if (ohos_kernel_type == "liteos_m") {
+    target_type = "static_library"
+  } else {
+    target_type = "shared_library"
+  }
   sources = [ "src/nativeapi_common.cpp" ]
   cflags = [ "-Wall" ]
   cflags_cc = cflags
diff --git a/js/builtin/filekit/BUILD.gn b/js/builtin/filekit/BUILD.gn
index d61d9b1..9979cef 100755
--- a/js/builtin/filekit/BUILD.gn
+++ b/js/builtin/filekit/BUILD.gn
@@ -13,9 +13,15 @@
 # limitations under the License.
 #
 
+import("//build/lite/config/component/lite_component.gni")
 import("//build/lite/config/subsystem/aafwk/path.gni")
 
-shared_library("ace_kit_file") {
+lite_library("ace_kit_file") {
+  if (ohos_kernel_type == "liteos_m") {
+    target_type = "static_library"
+  } else {
+    target_type = "shared_library"
+  }
   sources = [
     "src/nativeapi_fs.cpp",
     "src/nativeapi_fs_impl.c",
diff --git a/js/builtin/kvstorekit/BUILD.gn b/js/builtin/kvstorekit/BUILD.gn
index ddea7a3..65cae60 100755
--- a/js/builtin/kvstorekit/BUILD.gn
+++ b/js/builtin/kvstorekit/BUILD.gn
@@ -13,9 +13,15 @@
 # limitations under the License.
 #
 
+import("//build/lite/config/component/lite_component.gni")
 import("//build/lite/config/subsystem/aafwk/path.gni")
 
-shared_library("ace_kit_kvstore") {
+lite_library("ace_kit_kvstore") {
+  if (ohos_kernel_type == "liteos_m") {
+    target_type = "static_library"
+  } else {
+    target_type = "shared_library"
+  }
   sources = [
     "src/nativeapi_kv.cpp",
     "src/nativeapi_kv_impl.c",
diff --git a/kal/timer/BUILD.gn b/kal/timer/BUILD.gn
index 7b75e4c..8dacc97 100755
--- a/kal/timer/BUILD.gn
+++ b/kal/timer/BUILD.gn
@@ -11,7 +11,14 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-shared_library("kal_timer") {
+import("//build/lite/config/component/lite_component.gni")
+
+lite_library("kal_timer") {
+    if (ohos_kernel_type == "liteos_m") {
+        target_type = "static_library"
+    } else {
+        target_type = "shared_library"
+    }
     sources = [
         "src/kal.c",
     ]
diff --git a/timer_task/BUILD.gn b/timer_task/BUILD.gn
index 16e95ab..b0bed03 100755
--- a/timer_task/BUILD.gn
+++ b/timer_task/BUILD.gn
@@ -11,7 +11,14 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-shared_library("ace_kit_timer") {
+import("//build/lite/config/component/lite_component.gni")
+
+lite_library("ace_kit_timer") {
+    if (ohos_kernel_type == "liteos_m") {
+        target_type = "static_library"
+    } else {
+        target_type = "shared_library"
+    }
     sources = [
         "src/nativeapi_timer_task.c",
     ]
-- 
2.17.1

