From d53d2f2089aff41b6763544bc4f877e9b10259d3 Mon Sep 17 00:00:00 2001
From: yangjian <jianyang@bestechnic.com>
Date: Tue, 28 Dec 2021 19:33:00 +0800
Subject: [PATCH] third_party/mbedtls

Signed-off-by: yangjian <jianyang@bestechnic.com>
Change-Id: Ic70b7edbdff2793276bc69561ac3d2faaea6adc8
---
 library/entropy_poll.c | 25 +++++++++++++++----------
 1 file changed, 15 insertions(+), 10 deletions(-)

diff --git a/library/entropy_poll.c b/library/entropy_poll.c
index d7062ea..61a8d16 100755
--- a/library/entropy_poll.c
+++ b/library/entropy_poll.c
@@ -185,19 +185,24 @@ int mbedtls_platform_entropy_poll( void *data,
 #endif /* !MBEDTLS_NO_PLATFORM_ENTROPY */
 
 #if defined(MBEDTLS_TEST_NULL_ENTROPY)
+#include "stdlib.h"
+#include "hal_trng.h"
 int mbedtls_null_entropy_poll( void *data,
                     unsigned char *output, size_t len, size_t *olen )
 {
-    ((void) data);
-    ((void) output);
-    *olen = 0;
-
-    if( len < sizeof(unsigned char) )
-        return( 0 );
-
-    *olen = sizeof(unsigned char);
-
-    return( 0 );
+    int ret = -1;
+    uint32_t i;
+
+    // len = len > HAL_TRNG_DATA_LEN ? HAL_TRNG_DATA_LEN : len;
+    // ret = hal_get_trngdata(output, len);
+    // if (ret) {
+        for (i = 0; i < len; i++) {
+            output[i] = rand() & 0xFF;
+        }
+    // }
+ 
+    *olen = len;
+     return 0;
 }
 #endif
 
-- 
2.17.1

