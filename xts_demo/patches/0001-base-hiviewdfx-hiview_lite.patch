From 9c24c4e68a082a28527d27814a6e9a6e796f7c8b Mon Sep 17 00:00:00 2001
From: yangjian <jianyang@bestechnic.com>
Date: Sat, 25 Dec 2021 10:05:20 +0800
Subject: [PATCH] base/hiviewdfx/hiview_lite

Signed-off-by: yangjian <jianyang@bestechnic.com>
Change-Id: Ib478c338ff5520c1058956b5dd1847993bb48743
---
 BUILD.gn         | 5 +++++
 hiview_service.c | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/BUILD.gn b/BUILD.gn
index fb7fe5a..3001cb6 100755
--- a/BUILD.gn
+++ b/BUILD.gn
@@ -20,10 +20,15 @@ declare_args() {
   ohos_hiviewdfx_hievent_lite_event_switch = 1
   ohos_hiviewdfx_hiview_lite_output_module = -1
   ohos_hiviewdfx_hiview_lite_dir = ""
+  ohos_hiviewdfx_hiview_lite_hiview_service_stack_size = 2048
 }
 
 config("hiview_lite_config") {
   defines = [ "HIVIEW_FILE_DIR = \"$ohos_hiviewdfx_hiview_lite_dir\"" ]
+  if (defined(ohos_hiviewdfx_hiview_lite_hiview_service_stack_size) &&
+      ohos_hiviewdfx_hiview_lite_hiview_service_stack_size > 0) {
+    defines += [ "HIVIEW_SERVICE_TASK_STACK_SIZE=$ohos_hiviewdfx_hiview_lite_hiview_service_stack_size" ]
+  }
   include_dirs = [
     "//base/hiviewdfx/hiview_lite",
     "//kernel/liteos_m/kal",
diff --git a/hiview_service.c b/hiview_service.c
index 2d4d511..6f769d1 100755
--- a/hiview_service.c
+++ b/hiview_service.c
@@ -88,7 +88,7 @@ static BOOL MessageHandle(Service *service, Request *request)
 static TaskConfig GetTaskConfig(Service *service)
 {
     (void)service;
-    TaskConfig config = { LEVEL_LOW, PRI_NORMAL, 0x800, 10, SINGLE_TASK };
+    TaskConfig config = { LEVEL_LOW, PRI_NORMAL, HIVIEW_SERVICE_TASK_STACK_SIZE, 10, SINGLE_TASK };
     return config;
 }
 
-- 
2.17.1

